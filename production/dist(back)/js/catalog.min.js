const delayTimeout=300;let item_id_filter=[],selectFilters=[];function afterLoadPage(){pageNumberDefault(),getTitle(),getCaterorySelected(),getCountItems(),getValueSelect(),changeValueSelect(),filterPrice(),getParametres(),buildFilters(),spollers(),radioBuild(),radio(),checkboxBuild(),checkbox(),listenClickFilters(),paginatorBuild(),halfedPrice(),lazyLoad.revalidate()}function getCaterorySelected(){if($_GET("category")){let e=$_GET("category"),t=[];for(let l=0;l<item_id.length;l++){const i=item_id[l];e===i.categoryId&&t.push(i)}item_id=t}}function filterPrice(){if(item_id_pagging.length>1){let e=document.querySelector(".filters-catalogies__price").querySelectorAll("div"),t=document.querySelector(".filters-catalogies__price").querySelectorAll("input"),l=[],i=e.length-1;for(let e=0;e<item_id.length;e++){const t=item_id[e];l.push(parseInt(t.price[0]))}let r=1e3*Math.ceil(Math.min.apply(null,l)/1e3),a=1e3*Math.floor(Math.max.apply(null,l)/1e3),c=(a-r)/i,s=c;for(;s>1;)s/=10;for(s=Math.ceil(10*s);s<c;)s*=10;c=s;for(let e=1;e<=i;e++){let l=c*e,r=l-c;if(e===i){let e=a;for(;e>1;)e/=10;for(e=Math.ceil(10*e);e<l;)e*=10;l=e}t[e].setAttribute("data-min",r),t[e].setAttribute("data-max",l),t[e].setAttribute("data-label",`${r} - ${l} руб.`),t[e].setAttribute("value",`${r} - ${l} руб.`),1==e&&t[e].setAttribute("data-label",`Менее ${l} руб.`)}}}function getParametres(){let e=[],t=[],l=[],i=[],r=[],a=[],c={},s={},n={},o={},d={},u={};for(let c=0;c<item_id.length;c++){const s=item_id[c];function _(e,t){let l=s.param[e];l&&t.push(l)}_("Тип велосипеда",e),_("Тип рамы",t),_("Модельный год",l),_("Материал рамы",i),_("Тип тормозов",r),_("Диаметр колес",a)}f(l,n,"Модельный год"),f(a,u,"Диаметр колес"),f(e,c,"Тип велосипеда"),f(t,s,"Тип рамы"),f(i,o,"Материал рамы"),f(r,d,"Тип тормозов"),e=g(c),t=g(s),l=g(n),a=g(u),i=g(o),r=g(d),item_id_filter.push("Тип велосипеда","Тип рамы","Модельный год","Диаметр колес","Материал рамы","Тип тормозов");for(let e=0;e<item_id_filter.length;e++){const t=item_id_filter[e];item_id_filter[t]=[]}function f(e,t,l){for(let i=0;i<e.length;i++){const r=e[i];let a=r.replace(/,/,".");t[a]=[];for(let e=0;e<item_id.length;e++){const i=item_id[e];i.param[l]==r&&t[a].push(i)}}}function g(e){return Object.keys(e).sort((t,l)=>e[l].length-e[t].length).reduce((t,l)=>(t[l]=e[l],t),{})}item_id_filter["Тип велосипеда"].push(e),item_id_filter["Тип рамы"].push(t),item_id_filter["Модельный год"].push(l),item_id_filter["Диаметр колес"].push(a),item_id_filter["Материал рамы"].push(i),item_id_filter["Тип тормозов"].push(r)}function buildFilters(){let e=document.querySelector(".filters-catalogies"),t=document.querySelector(".filters-catalogies__footer");function l(e,t,l,i){let r=e.querySelector(".filters-catalogies__body"),a=document.createElement("input");var c,s;c=a,s={type:"checkbox","data-label":t,"data-sublabel":`(${l})`,value:t,"data-parent":i},Object.keys(s).forEach((function(e){c.setAttribute(e,s[e])})),r.appendChild(a)}item_id_filter.forEach(i=>{let r=document.createElement("div");r.classList.add("filters-catalogies__item"),e.insertBefore(r,t);let a=i,c=item_id_filter[i][0];!function(e,t){e.innerHTML=`\n                        <div class="filters-catalogies__title _spoller">\n                           <label class="filters-catalogies__label">${t}</label>\n                           <span class="filters-catalogies__decor"></span>\n                        </div>\n                        <div class="filters-catalogies__body">\n \n                        </div>`}(r,a);for(let e in c){l(r,e,c[e].length,a)}})}function listenClickFilters(){let e=document.querySelector(".catalogies__filters").querySelectorAll("input"),t=[],l=[];for(let i=0;i<e.length;i++){const r=e[i];let a=r.closest("div");a.addEventListener("click",(function(){switch(r.getAttribute("type")){case"radio":!function(){let e=document.querySelectorAll("._radio");t=[];for(let l=0;l<e.length;l++){let i=e[l].querySelector("._radio-item._active"),r=parseInt(i.querySelector("input").getAttribute("data-min")),a=parseInt(i.querySelector("input").getAttribute("data-max"));for(let e=0;e<item_id.length;e++){const l=item_id[e];let i=parseInt(l.price[0]);r<i&&i<a&&t.push(l)}}}();break;case"checkbox":!function(){let e=document.querySelector(".catalogies__filters").querySelectorAll("._checkbox._active");l=[];for(let t=0;t<e.length;t++){const i=e[t];let r=i.querySelector("input").getAttribute("value"),a=i.querySelector("input").getAttribute("data-parent");for(let e=0;e<item_id.length;e++){const t=item_id[e];t.param[a]==r&&l.push(t)}}}()}!function(){item_id_filterTMP=[];let e=t.length,i=l.length;if(e&&i)for(let e=0;e<t.length;e++){let i=t[e].vendorCode;for(let e=0;e<l.length;e++){const t=l[e];t.vendorCode==i&&item_id_filterTMP.push(t)}}!e&&i&&(item_id_filterTMP=l);e&&!i&&(item_id_filterTMP=t)}(),buildBage(a)}))}}function filterApply(){setTimeout(()=>{let e=document.querySelector(".filters-catalogies__apply"),t=document.querySelector(".filters-catalogies__bage");item_id_filterTMP.length?(e.classList.remove("_disable"),clickApply(e),clickApply(t)):(e.classList.add("_disable"),pagingArr(item_id),appendItem(item_id_pagging),document.querySelector(".bages-filter").innerHTML="",paginatorBuild(),halfedPrice(),lazyLoad.revalidate())},300)}
//! Клик по кнопкам "Применить"
function clickApply(e){e.addEventListener("click",()=>{listTaskFilters()})}function listTaskFilters(){goToPage(1),getValueSelect(),pagingArr(item_id_filterTMP),appendItem(item_id_pagging),setAttrSelect("item_id_filterTMP"),destroyBage(),scrollTo(0,400),getSelectFilters(),buildHeaderBage(),resetFilters(),closeMobileFilters(),getCountItems(),delSelectFiltersHeader(),paginatorBuild(),halfedPrice(),lazyLoad.revalidate()}function closeMobileFilters(){document.querySelector(".catalogies__filters").classList.remove("_active"),document.querySelector("body").classList.remove("_lock")}function buildBage(e){let t=e.closest(".filters-catalogies__item");destroyBage();let l=document.createElement("button"),i=item_id_filterTMP.length;i&&(l.classList.add("filters-catalogies__bage"),l.innerHTML="Показать "+i,t.appendChild(l),setTimeout(()=>{l.classList.add("_active")},1)),filterApply()}function destroyBage(){let e=document.querySelector(".filters-catalogies").querySelectorAll(".filters-catalogies__bage");if(e.length)for(let t=0;t<e.length;t++){const l=e[t];l.classList.remove("_active"),setTimeout(()=>{l.remove()},300)}}function setAttrSelect(e){let t=document.querySelector(".catalogies__sort").querySelectorAll("option");for(let l=0;l<t.length;l++){t[l].setAttribute("data-arr",e)}}function getSelectFilters(){selectFilters=[];let e=document.querySelector(".filters-catalogies").querySelectorAll("input");for(let t=0;t<e.length;t++){const l=e[t];if(l.closest("div").classList.contains("_active")){let e=l.getAttribute("value");"0"!==e&&selectFilters.push(e)}}}function buildHeaderBage(){let e=document.querySelector(".bages-filter");if(e.innerHTML="",selectFilters.length){let t=document.createElement("div");t.classList.add("bages-filter__item"),t.classList.add("bages-filter__item-reset"),t.innerHTML='<span class="bages-filter__name">Сбросить фильтры</span>',e.appendChild(t);for(let t=0;t<selectFilters.length;t++){const l=selectFilters[t];let i=document.createElement("div");i.classList.add("bages-filter__item"),i.innerHTML=`\n                        <span class="bages-filter__name">${l}</span>\n                        <span class="bages-filter__close _icon-close"></span>\n      `,e.appendChild(i)}}}function resetFilters(){let e=document.querySelector(".filters-catalogies__cancel"),t=document.querySelector(".bages-filter__item-reset");function l(e){e.addEventListener("click",()=>{resetFiltersTech()})}t&&l(t),l(e)}function resetFiltersTech(){item_id_filterTMP=[],document.querySelector(".bages-filter").innerHTML="",function(){let e=document.querySelector(".filters-catalogies").querySelectorAll("input");for(let t=0;t<e.length;t++){e[t].closest("div").classList.remove("_active")}}(),goToPage(1),getValueSelect(),pagingArr(item_id),appendItem(item_id_pagging),setAttrSelect("item_id"),scrollTo(0,400),getCountItems(),paginatorBuild(),halfedPrice(),lazyLoad.revalidate()}function delSelectFiltersHeader(){let e=document.querySelector(".bages-filter").querySelectorAll(".bages-filter__item"),t=document.querySelector(".filters-catalogies").querySelectorAll("input"),l=[];for(let i=0;i<e.length;i++){const r=e[i];r.classList.contains("bages-filter__item-reset")||r.addEventListener("click",()=>{let e=r.querySelector(".bages-filter__name").innerHTML;for(let i=0;i<t.length;i++){const r=t[i];let a=r.getAttribute("value"),c=r.getAttribute("data-parent");if(a==e){r.closest("div").classList.remove("_active");for(let t=0;t<item_id_filterTMP.length;t++){const i=item_id_filterTMP[t];i.param[c]!==e&&l.push(i)}}}item_id_filterTMP=l,item_id_filterTMP.length?listTaskFilters():resetFiltersTech()})}}function getTitle(){let e,t;$_GET("category")?(e=parent_id[$_GET("category")][0],t=document.querySelector(".catalogies__title").querySelector("h1"),t.innerHTML="Велосипеды "+e):(t=document.querySelector(".catalogies__title").querySelector("h1"),t.innerHTML="Все велосипеды")}function getCountItems(){let e,t=document.querySelector(".catalogies__title").querySelector("span");e=item_id_filterTMP.length?item_id_filterTMP.length:item_id.length,t.innerHTML=`Найдено: ${e} ${num2str(e,["товар","товара","товаров"])}`}function num2str(e,t){var l=(e=Math.abs(e)%100)%10;return e>10&&e<20?t[2]:l>1&&l<5?t[1]:1==l?t[0]:t[2]}afterLoadPage();